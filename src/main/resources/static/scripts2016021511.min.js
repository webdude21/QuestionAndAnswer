var questionAnswerAppConfig=function($routeProvider,$locationProvider,$httpProvider){var getTemplatePath=function(routeName){return"templates/"+routeName+".html"},routeUserChecks={authenticated:{authenticate:function(auth){return auth.isAuthenticated()}}},CONTROLLER_VIEW_MODEL_NAME="vm";$httpProvider.interceptors.push("errorHandlerHttpInterceptor"),$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",$locationProvider.html5Mode(!0),$routeProvider.when("/",{templateUrl:getTemplatePath("home"),controller:"HomeController",controllerAs:CONTROLLER_VIEW_MODEL_NAME}).when("/question/list-questions",{templateUrl:getTemplatePath("question/list-questions"),controller:"QuestionsController",controllerAs:CONTROLLER_VIEW_MODEL_NAME}).when("/question/ask-question",{templateUrl:getTemplatePath("question/ask-question"),controller:"AskQuestionsController",controllerAs:CONTROLLER_VIEW_MODEL_NAME,resolve:routeUserChecks.authenticated}).when("/question/:id",{templateUrl:getTemplatePath("question/detail"),controller:"DetailQuestionsController",controllerAs:CONTROLLER_VIEW_MODEL_NAME}).when("/unauthorized",{templateUrl:getTemplatePath("unauthorized")}).otherwise({redirectTo:"/"})};angular.module("templates",[]);var questionAndAnswer=angular.module("QuestionAndAnswer",["ngResource","ngRoute","templates"]).config(questionAnswerAppConfig).value("toastr",toastr).constant("serverRoutes",{currentUser:"api/authentication/currentuser",register:"api/authentication/register",usersRoute:"/api/users/",questions:"/api/questions",customViews:"/api/customviews"}).constant("credits",{author:"Webdude",appName:"Question & Answer",authorLink:"http://webdude.eu",appTitle:"Question & Answer"});questionAndAnswer.run(function($rootScope,$location){$rootScope.$on("$routeChangeError",function(ev,current,previous,rejection){"not authorized"===rejection&&$location.path("/unauthorized")})});var questionAndAnswer=angular.module("QuestionAndAnswer");questionAndAnswer.factory("Question",function($resource,serverRoutes){return $resource(serverRoutes.questions+"/:id/:reletedEntity",null,{getAll:{method:"GET"},getById:{method:"GET",params:{id:"@id"}},getQuestionsAnswers:{method:"GET",params:{id:"@id",reletedEntity:"answers"}},getQuestionUser:{method:"GET",params:{id:"@id",reletedEntity:"user"}},query:{method:"GET",isArray:!1}})});var questionAndAnswer=angular.module("QuestionAndAnswer");questionAndAnswer.factory("CustomViews",function($resource,serverRoutes){return $resource(serverRoutes.customViews+"/:type/:id/:action",null,{getQuestionById:{method:"GET",params:{id:"@id",type:"question"}},upvoteAnswer:{method:"PUT",params:{id:"@id",type:"answer",action:"upvote"}}})});questionAndAnswer.factory("errorHandlerHttpInterceptor",["$q","errorHandler",function($q,errorHandler){return{responseError:function(serverError){return errorHandler.processError(serverError),$q.reject(serverError)}}}]);questionAndAnswer.factory("identity",function(){return{isAuthenticated:function(){return!!this.currentUser},isAuthorizedForRole:function(role){return!!this.currentUser&&this.currentUser.roles.indexOf(role)>-1},isAuthorizedForAnyOfTheFollowingRoles:function(roles){return roles.any(this.isAuthorizedForRole)},authToken:function(){var user=this.currentUser;return user?btoa(user.username+":"+user.password):void 0},loggedInUser:function(){return this.isAuthenticated()?this.currentUser.firstName+" "+this.currentUser.lastName:void 0}}});questionAndAnswer.factory("auth",function($http,$q,identity,serverRoutes){var tryToLogin=function(){var user={};$http.get(serverRoutes.currentUser).then(function(response){200===response.status&&response.data.principal&&(angular.extend(user,response.data.principal),identity.currentUser=user)})};return{alredyLoggedIn:function(){this.haveCheckedLogin||tryToLogin(),this.haveCheckedLogin=!0},login:function(user){var headers=user?{authorization:"Basic "+btoa(user.username+":"+user.password)}:{},deferred=$q.defer();return $http.get(serverRoutes.currentUser,{headers:headers}).then(function(response){if(200===response.status&&response.data.principal){var user={};angular.extend(user,response.data.principal),identity.currentUser=user,deferred.resolve(!0)}else deferred.resolve(!1)},function(response){deferred.reject(response)}),deferred.promise},logout:function(){$http.get(serverRoutes.currentUser,{headers:{authorization:"Basic "+btoa("wrong:wrong")}}).then(function(response){if(401===response.status){var user={};identity.currentUser=user,deferred.resolve(!0)}else deferred.resolve(!1)},function(response){deferred.reject(response)});var deferred=$q.defer();identity.currentUser=void 0},isAuthenticated:function(){return identity.isAuthenticated()?!0:$q.reject("not authorized")},isAuthorizedForRole:function(role){return identity.isAuthorizedForRole(role)?!0:$q.reject("not authorized")},isAuthorizedForAnyOfTheFollowingRoles:function(roles){if(!(roles instanceof Array))throw new Error("The method expects an array");return identity.isAuthorizedForAnyOfTheFollowingRoles(roles)?!0:$q.reject("not authorized")}}});questionAndAnswer.controller("QuestionsController",function(Question,$http,notifier){this.getDetailLink=function(question){return"/question/"+question._links.self.href.split("/").slice(-1)},this.request={sort:"title",page:1,size:5,sortDirection:"asc",title:""},this["delete"]=function(question){$http["delete"](question._links.self.href).then(function(){notifier.success("Deleted!")},notifier.error)},this.query=function(req){return req.page<1?void(req.page=1):req.size<1?void(req.size=1):void(this.list=Question.query({sort:[req.sort,req.sortDirection].join(","),page:req.page-1,size:req.size}))},this.query(this.request)});questionAndAnswer.controller("DetailQuestionsController",function($routeParams,CustomViews){this.question=CustomViews.getQuestionById({id:$routeParams.id}),this.upvote=function(id){CustomViews.upvoteAnswer({id:id})}});questionAndAnswer.controller("AskQuestionsController",function(Question,notifier,identity,$location,serverRoutes){var onSuccessfullSave=function(savedQuestion,headers){notifier.success("The question is successfully saved!"),$location.path(/question/+headers().location.split("/").slice(-1))};this.submit=function(question){var resultQuestion;question.user=serverRoutes.usersRoute+identity.currentUser.id,resultQuestion=new Question(question),resultQuestion.$save(onSuccessfullSave)}});questionAndAnswer.controller("LoginController",function($location,notifier,auth,identity){this.identity=identity,this.login=function(user){auth.login(user).then(function(response){response?notifier.success("Successful login!"):notifier.error("Login failed")},notifier.error)},this.logout=function(){auth.logout(),notifier.success("Successful logout!"),this.user={},$location.path("/")}});questionAndAnswer.factory("notifier",function(toastr){return{success:function(msg){toastr.success(msg)},error:function(error){return error?(error.data&&error.data.message&&(error=error.data.message),error.statusText&&(error=error.statusText),error.message&&(error=error.message),void toastr.error(error)):void toastr("no message")}}});questionAndAnswer.factory("errorHandler",function(notifier,$location){return{processError:function(serverError){if(serverError.error_description&&notifier.error(serverError.error_description),serverError.data&&(notifier.error(serverError.data),$location.path("/not-found")),serverError.reason&&(notifier.error(serverError.reason),$location.path("/not-found")),serverError.modelState){var modelStateErrors=serverError.modelState;for(var propertyName in modelStateErrors)for(var errorMessages=modelStateErrors[propertyName],trimmedName=propertyName.substr(propertyName.indexOf(".")+1),i=0;i<errorMessages.length;i++){var currentError=errorMessages[i];notifier.error(trimmedName+" - "+currentError)}}}}});"use strict";questionAndAnswer.directive("question",function(){return{restrict:"E",templateUrl:"templates/directives/question.html",replace:!0,scope:{question:"="}}});"use strict";questionAndAnswer.directive("answer",function(){return{restrict:"E",templateUrl:"templates/directives/answer.html",replace:!0,scope:{answer:"="}}});questionAndAnswer.controller("PageController",function($scope,credits,auth,identity){identity.isAuthenticated()||auth.alredyLoggedIn(),$scope.viewModel={author:credits.author,authorLink:credits.authorLink,appTitle:credits.appTitle}});questionAndAnswer.controller("HomeController",function(){});angular.module("templates").run(["$templateCache", function($templateCache) {$templateCache.put("templates/home.html","");
$templateCache.put("templates/unauthorized.html","<div class=row><h1 class=text-center>You are not authorized to view this page! (don\'t worry they won\'t let me play there too!)</h1></div>");
$templateCache.put("templates/account/login.html","<div ng-controller=\"LoginController as vm\" class=navbar-right><form ng-hide=vm.identity.isAuthenticated() class=navbar-form><div class=form-group><input type=text placeholder=Username ng-model=vm.user.username class=form-control> <input type=password placeholder=Password ng-model=vm.user.password class=form-control></div><button ng-click=vm.login(vm.user) class=\"btn btn-primary\">Login</button> <a href=#/signup class=\"btn btn-primary\">Sign Up</a></form><ul ng-show=vm.identity.isAuthenticated() class=\"nav navbar-nav navbar-right\"><li class=dropdown><a href data-toggle=dropdown class=dropdown-toggle>{{vm.identity.loggedInUser()}}<span class=caret></span></a><ul class=dropdown-menu><li><a href=# ng-click=vm.logout()>Sign Out</a></li></ul></li></ul></div>");
$templateCache.put("templates/directives/answer.html","<blockquote class=blockquote-reverse><p>{{answer.content}}</p><span>{{answer.votesCount}}</span> <a href=# class=\"btn btn-success\">Vote</a></blockquote>");
$templateCache.put("templates/directives/question.html","<div><blockquote><p>{{question.question.title}} - published by {{question.user.firstName}} {{question.user.lastName}}</p><small class=wrap>{{question.question.content}}</small></blockquote><div ng-repeat=\"answer in question.answers\"><answer answer=answer></answer></div></div>");
$templateCache.put("templates/question/ask-question.html","<form><div class=form-group><label for=title class=\"col-md-2 control-label\">Title</label><div class=col-md-10><input type=text ng-model=vm.question.title id=title placeholder=Title class=form-control></div></div><div class=form-group><label for=content class=\"col-md-2 control-label\">Content</label><div class=col-md-10><input type=text ng-model=vm.question.content id=content placeholder=Content class=form-control></div></div><button ng-click=vm.submit(vm.question) class=\"btn btn-primary\">Submit</button></form>");
$templateCache.put("templates/question/detail.html","<question question=vm.question></question>");
$templateCache.put("templates/question/list-questions.html","<div class=row><div class=col-md-3><p class=text-center>Sort by:</p><select ng-model=vm.request.sort ng-change=vm.query(vm.request) class=form-control><option value=title>Title</option><option value=content>Content</option></select></div><div class=col-md-3><p class=text-center>Sort direction:</p><select ng-model=vm.request.sortDirection ng-change=vm.query(vm.request) class=form-control><option value=asc>Ascending</option><option value=desc>Descending</option></select></div><div class=col-md-3><p class=text-center>Page:</p><input type=number ng-model=vm.request.page ng-change=vm.query(vm.request) class=form-control></div><div class=col-md-3><p class=text-center>Page size:</p><input type=number ng-model=vm.request.size ng-change=vm.query(vm.request) class=form-control></div></div><hr><div class=row><div ng-repeat=\"question in vm.list._embedded.questions\"><div class=\"alert alert-dismissible alert-info\"><button type=button class=close data-dismiss=alert ng-click=vm.delete(question)>×</button> <strong class=wrap><a href={{vm.getDetailLink(question)}}>{{question.title}}</a></strong></div></div></div>");}]);